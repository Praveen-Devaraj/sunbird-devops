@Library('deploy-conf') _
node( ) {
    stage('Checkout') {
                cleanWs()
                sh "git clone https://github.com/project-sunbird/sunbird-devops.git -b ${branch_or_tag} ."
                dir('private') {
                  checkout scm
                }
            }
    stage('deploy') {
       values = [:]
                envDir = sh(returnStdout: true, script: "echo $JOB_NAME").split('/')[-3].trim()
                module = sh(returnStdout: true, script: "echo $JOB_NAME").split('/')[-2].trim()
                jobName = sh(returnStdout: true, script: "echo $JOB_NAME").split('/')[-1].trim()
                currentWs = sh(returnStdout: true, script: 'pwd').trim()
                ansiblePlaybook = "${currentWs}/private/ansible/log4j_fix_verify.yml"
                ansibleExtraArgs = "--extra-vars=\"hosts=${params.hosts}\" --vault-password-file /var/lib/jenkins/secrets/vault-pass -v"
                values.put('currentWs', currentWs)
                values.put('env', envDir)
                values.put('module', module)
                values.put('jobName', jobName)
                values.put('ansiblePlaybook', ansiblePlaybook)
                values.put('ansibleExtraArgs', ansibleExtraArgs)
                println values
                ansible_playbook_run(values)
                currentBuild.result = "SUCCESS"
                currentBuild.description = "Branch_private: ${params.branch_or_tag}"
        }
}
